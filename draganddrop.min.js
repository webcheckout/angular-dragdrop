!function(e){"use strict";function a(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),void 0!==e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&("copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed:"copyMove"!==e.dataTransfer.effectAllowed&&"copymove"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect=e.ctrlKey?"copy":"move"))}if("ondrag"in document.createElement("a")){var n=e.module("ang-drag-drop",[]);n.directive("uiDraggable",["$parse","$rootScope","$dragImage",function(n,t,r){return function(o,d,i){var f,s,l=!1,g=i.draggingClass||"on-dragging";function v(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),setTimeout((function(){d.unbind("$destroy",v)}),0);var r=i.dragChannel||"defaultchannel";if(t.$broadcast("ANGULAR_DRAG_END",e,r),a(e),e.dataTransfer&&"none"!==e.dataTransfer.dropEffect){if(i.onDropSuccess){var f=n(i.onDropSuccess);o.$evalAsync((function(){f(o,{$event:e})}))}}else if(e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&i.onDropFailure){var s=n(i.onDropFailure);o.$evalAsync((function(){s(o,{$event:e})}))}d.removeClass(g)}function u(a){if(a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),!l||s.classList.contains(f)){var u=i.dragChannel||"defaultchannel",c="";i.drag&&(c=o.$eval(i.drag));var p=i.dragImage||null;d.addClass(g),d.bind("$destroy",v);var $=!(document.uniqueID||window.opera);if(p&&$){var m=n(i.dragImage);o.$apply((function(){var n=m(o,{$event:a});if(n&&(e.isString(n)&&(n=r.generate(n)),n.image)){var t=n.xOffset||0,d=n.yOffset||0;a.dataTransfer.setDragImage(n.image,t,d)}}))}else i.dragImageElementId&&function(a,t){var r;a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),r=n(t),o.$apply((function(){var n,t=r(o,{$event:a});t&&e.isString(t)&&(n=document.getElementById(t))&&a.dataTransfer.setDragImage(n,0,0)}))}(a,i.dragImageElementId);var h={data:c,channel:u,offset:{x:a.offsetX,y:a.offsetY}},D=e.toJson(h);if(a.dataTransfer.setData("text",D),a.dataTransfer.effectAllowed="copyMove",i.onDragStart){var T=n(i.onDragStart);o.$evalAsync((function(){T(o,{$event:a})}))}t.$broadcast("ANGULAR_DRAG_START",a,u,h)}else a.preventDefault()}d.attr("draggable",!1),o.$watch(i.uiDraggable,(function(e){e?(d.attr("draggable",e),d.bind("dragend",v),d.bind("dragstart",u)):(d.removeAttr("draggable"),d.unbind("dragend",v),d.unbind("dragstart",u))})),e.isString(i.dragHandleClass)&&(l=!0,f=i.dragHandleClass.trim()||"drag-handle",d.bind("mousedown",(function(e){s=e.target})))}}]),n.directive("uiOnDrop",["$parse","$rootScope",function(n,t){return function(r,o,d){var i=0,f=d.dropChannel||"defaultchannel",s="",l=d.dragEnterClass||"on-drag-enter",g=d.dragHoverClass||"on-drag-hover",v=n(d.onDragEnter),u=n(d.onDragLeave),c=n(d.uiOnDragOver);let p=function(e){var a=this.$root.$$phase;"$apply"===a||"$digest"===a?e&&"function"==typeof e&&e():this.$apply(e)};function $(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),d.uiOnDragOver&&r.$evalAsync((function(){c(r,{$event:e,$channel:f})})),!1}function m(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===--i&&(r.$evalAsync((function(){u(r,{$event:e,$channel:f})})),o.addClass(l),o.removeClass(g)),d.uiOnDragLeave){var a=n(d.uiOnDragLeave);r.$evalAsync((function(){a(r,{$event:e,$channel:f})}))}}function h(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===i&&(r.$evalAsync((function(){v(r,{$event:e,$channel:f})})),o.removeClass(l),o.addClass(g)),i++,d.uiOnDragEnter){var a=n(d.uiOnDragEnter);r.$evalAsync((function(){a(r,{$event:e,$channel:f})}))}t.$broadcast("ANGULAR_HOVER",s)}function D(t){t.originalEvent&&(t.dataTransfer=t.originalEvent.dataTransfer),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var f=t.dataTransfer.getData("text");f=e.fromJson(f);var s=function(e){for(var a={x:e.offsetX,y:e.offsetY},n=e.target;n!==o[0];)if(a.x=a.x+n.offsetLeft,a.y=a.y+n.offsetTop,!(n=n.offsetParent))return null;return a}(t),g=s?{x:s.x-f.offset.x,y:s.y-f.offset.y}:null;a(t);var v=n(d.uiOnDrop);p((function(){v(r,{$data:f.data,$event:t,$channel:f.channel,$position:g})})),o.removeClass(l),i=0}function T(e){return e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer.dropEffect="none",!1}var b=t.$on("ANGULAR_DRAG_START",(function(e,a,t,i){s=t;var g=!0;(function(e,a){return"*"===a||new RegExp("(\\s|[,])+("+e+")(\\s|[,])+","i").test(","+a+",")}(t,f)||(g=!1),g&&d.dropValidate)&&(g=n(d.dropValidate)(r,{$drop:{scope:r,element:o},$event:a,$data:i.data,$channel:i.channel}));g?(o.bind("dragover",$),o.bind("dragenter",h),o.bind("dragleave",m),o.bind("drop",D),o.addClass(l)):(o.bind("dragover",T),o.bind("dragenter",T),o.bind("dragleave",T),o.bind("drop",T),o.removeClass(l))})),y=t.$on("ANGULAR_DRAG_END",(function(){o.unbind("dragover",$),o.unbind("dragenter",h),o.unbind("dragleave",m),o.unbind("drop",D),o.removeClass(g),o.removeClass(l),o.unbind("dragover",T),o.unbind("dragenter",T),o.unbind("dragleave",T),o.unbind("drop",T)}));r.$on("$destroy",(function(){b(),y()})),d.$observe("dropChannel",(function(e){e&&(f=e)}))}}]),n.constant("$dragImageConfig",{height:20,width:200,padding:10,font:"bold 11px Arial",fontColor:"#eee8d5",backgroundColor:"#93a1a1",xOffset:0,yOffset:0}),n.service("$dragImage",["$dragImageConfig",function(a){var n="â€¦";this.generate=function(t,r){var o=e.extend({},a,r||{}),d=document.createElement("canvas");d.height=o.height,d.width=o.width;var i=d.getContext("2d");i.fillStyle=o.backgroundColor,i.fillRect(0,0,o.width,o.height),i.font=o.font,i.fillStyle=o.fontColor;var f=function(e,a,t){var r=e.measureText(a).width;if(r<t.width)return a;for(;r+t.padding>t.width;)a=a.substring(0,a.length-1),r=e.measureText(a+n).width;return a+n}(i,t,o);i.fillText(f,4,o.padding+4);var s=new Image;return s.src=d.toDataURL(),{image:s,xOffset:o.xOffset,yOffset:o.yOffset}}}])}else e.module("ang-drag-drop",[])}(angular);