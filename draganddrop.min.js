!function(e){"use strict";function a(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),void 0!==e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&("copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed:"copyMove"!==e.dataTransfer.effectAllowed&&"copymove"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect=e.ctrlKey?"copy":"move"))}if("ondrag"in document.createElement("a")){var n=e.module("ang-drag-drop",[]);n.directive("uiDraggable",["$parse","$rootScope","$dragImage",function(n,r,t){return function(o,f,d){var i,s,l=!1,g=d.draggingClass||"on-dragging";function c(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),setTimeout((function(){f.off("$destroy",c)}),0);var t=d.dragChannel||"defaultchannel";if(r.$broadcast("ANGULAR_DRAG_END",e,t),a(e),e.dataTransfer&&"none"!==e.dataTransfer.dropEffect){if(d.onDropSuccess){var i=n(d.onDropSuccess);o.$evalAsync((function(){i(o,{$event:e})}))}}else if(e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&d.onDropFailure){var s=n(d.onDropFailure);o.$evalAsync((function(){s(o,{$event:e})}))}f.removeClass(g)}function v(a){if(a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),!l||s.classList.contains(i)){var v=d.dragChannel||"defaultchannel",u="";d.drag&&(u=o.$eval(d.drag));var p=d.dragImage||null;f.addClass(g),f.on("$destroy",c);var $=!(document.uniqueID||window.opera);if(p&&$){var m=n(d.dragImage);o.$apply((function(){var n=m(o,{$event:a});if(n&&(e.isString(n)&&(n=t.generate(n)),n.image)){var r=n.xOffset||0,f=n.yOffset||0;a.dataTransfer.setDragImage(n.image,r,f)}}))}else d.dragImageElementId&&function(a,r){var t;a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),t=n(r),o.$apply((function(){var n,r=t(o,{$event:a});r&&e.isString(r)&&(n=document.getElementById(r))&&a.dataTransfer.setDragImage(n,0,0)}))}(a,d.dragImageElementId);var D={data:u,channel:v,offset:{x:a.offsetX,y:a.offsetY}},T=e.toJson(D);if(a.dataTransfer.setData("text",T),a.dataTransfer.effectAllowed="copyMove",d.onDragStart){var h=n(d.onDragStart);o.$evalAsync((function(){h(o,{$event:a})}))}r.$broadcast("ANGULAR_DRAG_START",a,v,D)}else a.preventDefault()}f.attr("draggable",!1),o.$watch(d.uiDraggable,(function(e){e?(f.attr("draggable",e),f.on("dragend",c),f.on("dragstart",v)):(f.removeAttr("draggable"),f.off("dragend",c),f.off("dragstart",v))})),e.isString(d.dragHandleClass)&&(l=!0,i=d.dragHandleClass.trim()||"drag-handle",f.on("mousedown",(function(e){s=e.target})))}}]),n.directive("uiOnDrop",["$parse","$rootScope","$window",function(n,r,t){return function(o,f,d){var i=0,s=d.dropChannel||"defaultchannel",l="",g=d.dragEnterClass||"on-drag-enter",c=d.dragHoverClass||"on-drag-hover",v=n(d.onDragEnter),u=n(d.onDragLeave),p=n(d.uiOnDragOver),$=function(e){e.clientY<20&&t.scrollBy(0,-100),e.clientY>t.innerHeight-20&&t.scrollBy(0,100)};function m(e){return $(e),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),d.uiOnDragOver&&o.$evalAsync((function(){p(o,{$event:e,$channel:s})})),!1}function D(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===--i&&(o.$evalAsync((function(){u(o,{$event:e,$channel:s})})),f.addClass(g),f.removeClass(c)),d.uiOnDragLeave){var a=n(d.uiOnDragLeave);o.$evalAsync((function(){a(o,{$event:e,$channel:s})}))}}function T(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===i&&(o.$evalAsync((function(){v(o,{$event:e,$channel:s})})),f.removeClass(g),f.addClass(c)),i++,d.uiOnDragEnter){var a=n(d.uiOnDragEnter);o.$evalAsync((function(){a(o,{$event:e,$channel:s})}))}r.$broadcast("ANGULAR_HOVER",l)}function h(r){r.originalEvent&&(r.dataTransfer=r.originalEvent.dataTransfer),r.preventDefault&&r.preventDefault(),r.stopPropagation&&r.stopPropagation();var t=r.dataTransfer.getData("text");t=e.fromJson(t);var s=function(e){for(var a={x:e.offsetX,y:e.offsetY},n=e.target;n!==f[0];)if(a.x=a.x+n.offsetLeft,a.y=a.y+n.offsetTop,!(n=n.offsetParent))return null;return a}(r),l=s?{x:s.x-t.offset.x,y:s.y-t.offset.y}:null;a(r);var c=n(d.uiOnDrop);o.$evalAsync((function(){c(o,{$data:t.data,$event:r,$channel:t.channel,$position:l})})),f.removeClass(g),i=0}function y(e){return e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer.dropEffect="none",!1}var A=r.$on("ANGULAR_DRAG_START",(function(e,a,r,t){l=r;var i=!0;(function(e,a){return"*"===a||new RegExp("(\\s|[,])+("+e+")(\\s|[,])+","i").test(","+a+",")}(r,s)||(i=!1),i&&d.dropValidate)&&(i=n(d.dropValidate)(o,{$drop:{scope:o,element:f},$event:a,$data:t.data,$channel:t.channel}));i?(f.on("dragover",m),f.on("dragenter",T),f.on("dragleave",D),f.on("drop",h),f.addClass(g)):(f.on("dragover",y),f.on("dragenter",y),f.on("dragleave",y),f.on("drop",y),f.removeClass(g))})),E=r.$on("ANGULAR_DRAG_END",(function(){f.off("dragover",m),f.off("dragenter",T),f.off("dragleave",D),f.off("drop",h),f.removeClass(c),f.removeClass(g),f.off("dragover",y),f.off("dragenter",y),f.off("dragleave",y),f.off("drop",y)}));o.$on("$destroy",(function(){A(),E()})),d.$observe("dropChannel",(function(e){e&&(s=e)}))}}]),n.constant("$dragImageConfig",{height:20,width:200,padding:10,font:"bold 11px Arial",fontColor:"#eee8d5",backgroundColor:"#93a1a1",xOffset:0,yOffset:0}),n.service("$dragImage",["$dragImageConfig",function(a){var n="â€¦";this.generate=function(r,t){var o=e.extend({},a,t||{}),f=document.createElement("canvas");f.height=o.height,f.width=o.width;var d=f.getContext("2d");d.fillStyle=o.backgroundColor,d.fillRect(0,0,o.width,o.height),d.font=o.font,d.fillStyle=o.fontColor;var i=function(e,a,r){var t=e.measureText(a).width;if(t<r.width)return a;for(;t+r.padding>r.width;)a=a.substring(0,a.length-1),t=e.measureText(a+n).width;return a+n}(d,r,o);d.fillText(i,4,o.padding+4);var s=new Image;return s.src=f.toDataURL(),{image:s,xOffset:o.xOffset,yOffset:o.yOffset}}}])}else e.module("ang-drag-drop",[])}(angular);