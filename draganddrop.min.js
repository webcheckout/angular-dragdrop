!function(e){"use strict";function a(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),void 0!==e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&("copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed:"copyMove"!==e.dataTransfer.effectAllowed&&"copymove"!==e.dataTransfer.effectAllowed||(e.dataTransfer.dropEffect=e.ctrlKey?"copy":"move"))}if("ondrag"in document.createElement("a")){var n=e.module("ang-drag-drop",[]);n.directive("uiDraggable",["$parse","$rootScope","$dragImage",function(n,r,t){return function(o,f,d){var i,s,l=!1,g=d.draggingClass||"on-dragging";function v(e){e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),setTimeout((function(){f.off("$destroy",v)}),0);var t=d.dragChannel||"defaultchannel";if(r.$broadcast("ANGULAR_DRAG_END",e,t),a(e),e.dataTransfer&&"none"!==e.dataTransfer.dropEffect){if(d.onDropSuccess){var i=n(d.onDropSuccess);o.$evalAsync((function(){i(o,{$event:e})}))}}else if(e.dataTransfer&&"none"===e.dataTransfer.dropEffect&&d.onDropFailure){var s=n(d.onDropFailure);o.$evalAsync((function(){s(o,{$event:e})}))}f.removeClass(g)}function c(a){if(a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),!l||s.classList.contains(i)){var c=d.dragChannel||"defaultchannel",u="";d.drag&&(u=o.$eval(d.drag));var p=d.dragImage||null;f.addClass(g),f.on("$destroy",v);var $=!(document.uniqueID||window.opera);if(p&&$){var m=n(d.dragImage);o.$apply((function(){var n=m(o,{$event:a});if(n&&(e.isString(n)&&(n=t.generate(n)),n.image)){var r=n.xOffset||0,f=n.yOffset||0;a.dataTransfer.setDragImage(n.image,r,f)}}))}else d.dragImageElementId&&function(a,r){var t;a.originalEvent&&(a.dataTransfer=a.originalEvent.dataTransfer),t=n(r),o.$apply((function(){var n,r=t(o,{$event:a});r&&e.isString(r)&&(n=document.getElementById(r))&&a.dataTransfer.setDragImage(n,0,0)}))}(a,d.dragImageElementId);var D={data:u,channel:c,offset:{x:a.offsetX,y:a.offsetY}},T=e.toJson(D);if(a.dataTransfer.setData("text",T),a.dataTransfer.effectAllowed="copyMove",d.onDragStart){var h=n(d.onDragStart);o.$evalAsync((function(){h(o,{$event:a})}))}r.$broadcast("ANGULAR_DRAG_START",a,c,D)}else a.preventDefault()}f.attr("draggable",!1),o.$watch(d.uiDraggable,(function(e){e?(f.attr("draggable",e),f.on("dragend",v),f.on("dragstart",c)):(f.removeAttr("draggable"),f.off("dragend",v),f.off("dragstart",c))})),e.isString(d.dragHandleClass)&&(l=!0,i=d.dragHandleClass.trim()||"drag-handle",f.on("mousedown",(function(e){s=e.target})))}}]),n.directive("uiOnDrop",["$parse","$rootScope",function(n,r){return function(t,o,f){var d=0,i=f.dropChannel||"defaultchannel",s="",l=f.dragEnterClass||"on-drag-enter",g=f.dragHoverClass||"on-drag-hover",v=n(f.onDragEnter),c=n(f.onDragLeave),u=n(f.uiOnDragOver);function p(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),f.uiOnDragOver&&t.$evalAsync((function(){u(t,{$event:e,$channel:i})})),!1}function $(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===--d&&(t.$evalAsync((function(){c(t,{$event:e,$channel:i})})),o.addClass(l),o.removeClass(g)),f.uiOnDragLeave){var a=n(f.uiOnDragLeave);t.$evalAsync((function(){a(t,{$event:e,$channel:i})}))}}function m(e){if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),0===d&&(t.$evalAsync((function(){v(t,{$event:e,$channel:i})})),o.removeClass(l),o.addClass(g)),d++,f.uiOnDragEnter){var a=n(f.uiOnDragEnter);t.$evalAsync((function(){a(t,{$event:e,$channel:i})}))}r.$broadcast("ANGULAR_HOVER",s)}function D(r){r.originalEvent&&(r.dataTransfer=r.originalEvent.dataTransfer),r.preventDefault&&r.preventDefault(),r.stopPropagation&&r.stopPropagation();var i=r.dataTransfer.getData("text");i=e.fromJson(i);var s=function(e){for(var a={x:e.offsetX,y:e.offsetY},n=e.target;n!==o[0];)if(a.x=a.x+n.offsetLeft,a.y=a.y+n.offsetTop,!(n=n.offsetParent))return null;return a}(r),g=s?{x:s.x-i.offset.x,y:s.y-i.offset.y}:null;a(r);var v=n(f.uiOnDrop);t.$evalAsync((function(){v(t,{$data:i.data,$event:r,$channel:i.channel,$position:g})})),o.removeClass(l),d=0}function T(e){return e.originalEvent&&(e.dataTransfer=e.originalEvent.dataTransfer),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.dataTransfer.dropEffect="none",!1}var h=r.$on("ANGULAR_DRAG_START",(function(e,a,r,d){s=r;var g=!0;(function(e,a){return"*"===a||new RegExp("(\\s|[,])+("+e+")(\\s|[,])+","i").test(","+a+",")}(r,i)||(g=!1),g&&f.dropValidate)&&(g=n(f.dropValidate)(t,{$drop:{scope:t,element:o},$event:a,$data:d.data,$channel:d.channel}));g?(o.on("dragover",p),o.on("dragenter",m),o.on("dragleave",$),o.on("drop",D),o.addClass(l)):(o.on("dragover",T),o.on("dragenter",T),o.on("dragleave",T),o.on("drop",T),o.removeClass(l))})),y=r.$on("ANGULAR_DRAG_END",(function(){o.off("dragover",p),o.off("dragenter",m),o.off("dragleave",$),o.off("drop",D),o.removeClass(g),o.removeClass(l),o.off("dragover",T),o.off("dragenter",T),o.off("dragleave",T),o.off("drop",T)}));t.$on("$destroy",(function(){h(),y()})),f.$observe("dropChannel",(function(e){e&&(i=e)}))}}]),n.constant("$dragImageConfig",{height:20,width:200,padding:10,font:"bold 11px Arial",fontColor:"#eee8d5",backgroundColor:"#93a1a1",xOffset:0,yOffset:0}),n.service("$dragImage",["$dragImageConfig",function(a){var n="â€¦";this.generate=function(r,t){var o=e.extend({},a,t||{}),f=document.createElement("canvas");f.height=o.height,f.width=o.width;var d=f.getContext("2d");d.fillStyle=o.backgroundColor,d.fillRect(0,0,o.width,o.height),d.font=o.font,d.fillStyle=o.fontColor;var i=function(e,a,r){var t=e.measureText(a).width;if(t<r.width)return a;for(;t+r.padding>r.width;)a=a.substring(0,a.length-1),t=e.measureText(a+n).width;return a+n}(d,r,o);d.fillText(i,4,o.padding+4);var s=new Image;return s.src=f.toDataURL(),{image:s,xOffset:o.xOffset,yOffset:o.yOffset}}}])}else e.module("ang-drag-drop",[])}(angular);